/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => SelectiveReadModePlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian2 = require("obsidian");

// settings.ts
var import_obsidian = require("obsidian");
var DEFAULT_SETTINGS = {
  rules: []
};
var FileFolderSuggestModal = class extends import_obsidian.FuzzySuggestModal {
  constructor(app, onChoose, showFolders = true) {
    super(app);
    this.onChoose = onChoose;
    this.showFolders = showFolders;
  }
  getItems() {
    const items = [];
    const addItems = (folder) => {
      if (this.showFolders && folder.path) {
        items.push(folder);
      }
      for (const child of folder.children) {
        if (child instanceof import_obsidian.TFile && child.extension === "md") {
          items.push(child);
        } else if (child instanceof import_obsidian.TFolder) {
          addItems(child);
        }
      }
    };
    addItems(this.app.vault.getRoot());
    return items;
  }
  getItemText(item) {
    return item.path || "/";
  }
  onChooseItem(item) {
    this.onChoose(item);
  }
};
var SelectiveReadModeSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "Selective Read Mode Settings" });
    new import_obsidian.Setting(containerEl).setName("Read Mode Rules").setDesc("Configure which files or folders should open in read mode").addButton((button) => {
      button.setButtonText("Add Rule").setCta().onClick(() => {
        new FileFolderSuggestModal(this.app, (item) => {
          const rule = {
            path: item.path,
            type: item instanceof import_obsidian.TFolder ? "folder" : "file"
          };
          this.plugin.settings.rules.push(rule);
          this.plugin.saveSettings();
          this.display();
        }).open();
      });
    });
    this.plugin.settings.rules.forEach((rule, index) => {
      const setting = new import_obsidian.Setting(containerEl).setName(rule.path || "/").setDesc(`Type: ${rule.type}`).addDropdown((dropdown) => {
        dropdown.addOption("file", "File").addOption("folder", "Folder").setValue(rule.type).onChange(async (value) => {
          rule.type = value;
          await this.plugin.saveSettings();
          this.display();
        });
      }).addExtraButton((button) => {
        button.setIcon("pencil").setTooltip("Change path").onClick(() => {
          new FileFolderSuggestModal(
            this.app,
            (item) => {
              rule.path = item.path;
              rule.type = item instanceof import_obsidian.TFolder ? "folder" : "file";
              this.plugin.saveSettings();
              this.display();
            },
            rule.type === "folder"
          ).open();
        });
      }).addExtraButton((button) => {
        button.setIcon("trash").setTooltip("Remove").onClick(async () => {
          this.plugin.settings.rules.splice(index, 1);
          await this.plugin.saveSettings();
          this.display();
        });
      });
      setting.nameEl.prepend(
        createSpan({
          text: rule.type === "folder" ? "\u{1F4C1} " : "\u{1F4C4} ",
          cls: "read-mode-icon"
        })
      );
    });
    containerEl.createEl("h3", { text: "Quick Actions" });
    new import_obsidian.Setting(containerEl).setName("Add current location").setDesc("Add the current file or its parent folder").addButton((button) => {
      button.setButtonText("Add Current File").onClick(async () => {
        const file = this.app.workspace.getActiveFile();
        if (file) {
          this.plugin.settings.rules.push({
            path: file.path,
            type: "file"
          });
          await this.plugin.saveSettings();
          this.display();
        }
      });
    }).addButton((button) => {
      button.setButtonText("Add Current Folder").onClick(async () => {
        const file = this.app.workspace.getActiveFile();
        if (file) {
          const folder = file.parent;
          if (folder) {
            this.plugin.settings.rules.push({
              path: folder.path,
              type: "folder"
            });
            await this.plugin.saveSettings();
            this.display();
          }
        }
      });
    });
  }
};

// main.ts
var SelectiveReadModePlugin = class extends import_obsidian2.Plugin {
  async onload() {
    await this.loadSettings();
    await this.migrateSettings();
    this.addSettingTab(new SelectiveReadModeSettingTab(this.app, this));
    this.registerEvent(
      this.app.workspace.on("file-open", (file) => {
        if (!file)
          return;
        setTimeout(() => {
          const view = this.app.workspace.getActiveViewOfType(import_obsidian2.MarkdownView);
          if (!view)
            return;
          if (this.shouldOpenInReadMode(file.path)) {
            view.setState({ mode: "preview" }, { history: false });
          }
        }, 100);
      })
    );
  }
  shouldOpenInReadMode(filePath) {
    const normalized = (0, import_obsidian2.normalizePath)(filePath);
    return this.settings.rules.some((rule) => {
      const rulePath = (0, import_obsidian2.normalizePath)(rule.path);
      if (rule.type === "file") {
        return rulePath === normalized;
      } else {
        if (!rulePath)
          return true;
        return normalized.startsWith(rulePath + "/") || normalized === rulePath;
      }
    });
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
  async migrateSettings() {
    const data = await this.loadData();
    if ((data == null ? void 0 : data.readModeFiles) && !(data == null ? void 0 : data.rules)) {
      this.settings = {
        rules: data.readModeFiles.map((path) => ({
          path,
          type: "file"
        }))
      };
      await this.saveSettings();
    }
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJzZXR0aW5ncy50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgUGx1Z2luLCBNYXJrZG93blZpZXcsIFRGaWxlLCBub3JtYWxpemVQYXRoIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQge1xuICBTZWxlY3RpdmVSZWFkTW9kZVNldHRpbmdUYWIsXG4gIFNlbGVjdGl2ZVJlYWRNb2RlU2V0dGluZ3MsXG4gIERFRkFVTFRfU0VUVElOR1MsXG4gIFJlYWRNb2RlUnVsZSxcbn0gZnJvbSBcIi4vc2V0dGluZ3NcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VsZWN0aXZlUmVhZE1vZGVQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xuICBzZXR0aW5nczogU2VsZWN0aXZlUmVhZE1vZGVTZXR0aW5ncztcblxuICBhc3luYyBvbmxvYWQoKSB7XG4gICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcblxuICAgIC8vIE1pZ3JhdGUgb2xkIHNldHRpbmdzIGlmIHRoZXkgZXhpc3RcbiAgICBhd2FpdCB0aGlzLm1pZ3JhdGVTZXR0aW5ncygpO1xuXG4gICAgdGhpcy5hZGRTZXR0aW5nVGFiKG5ldyBTZWxlY3RpdmVSZWFkTW9kZVNldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcblxuICAgIHRoaXMucmVnaXN0ZXJFdmVudChcbiAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbihcImZpbGUtb3BlblwiLCAoZmlsZTogVEZpbGUgfCBudWxsKSA9PiB7XG4gICAgICAgIGlmICghZmlsZSkgcmV0dXJuO1xuXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xuICAgICAgICAgIGlmICghdmlldykgcmV0dXJuO1xuXG4gICAgICAgICAgaWYgKHRoaXMuc2hvdWxkT3BlbkluUmVhZE1vZGUoZmlsZS5wYXRoKSkge1xuICAgICAgICAgICAgdmlldy5zZXRTdGF0ZSh7IG1vZGU6IFwicHJldmlld1wiIH0sIHsgaGlzdG9yeTogZmFsc2UgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LCAxMDApO1xuICAgICAgfSksXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgc2hvdWxkT3BlbkluUmVhZE1vZGUoZmlsZVBhdGg6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSBub3JtYWxpemVQYXRoKGZpbGVQYXRoKTtcblxuICAgIHJldHVybiB0aGlzLnNldHRpbmdzLnJ1bGVzLnNvbWUoKHJ1bGUpID0+IHtcbiAgICAgIGNvbnN0IHJ1bGVQYXRoID0gbm9ybWFsaXplUGF0aChydWxlLnBhdGgpO1xuXG4gICAgICBpZiAocnVsZS50eXBlID09PSBcImZpbGVcIikge1xuICAgICAgICAvLyBFeGFjdCBtYXRjaCBmb3IgZmlsZXNcbiAgICAgICAgcmV0dXJuIHJ1bGVQYXRoID09PSBub3JtYWxpemVkO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRm9yIGZvbGRlcnMsIGNoZWNrIGlmIGZpbGUgaXMgd2l0aGluIHRoYXQgZm9sZGVyXG4gICAgICAgIGlmICghcnVsZVBhdGgpIHJldHVybiB0cnVlOyAvLyBSb290IGZvbGRlclxuICAgICAgICByZXR1cm4gbm9ybWFsaXplZC5zdGFydHNXaXRoKHJ1bGVQYXRoICsgXCIvXCIpIHx8IG5vcm1hbGl6ZWQgPT09IHJ1bGVQYXRoO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xuICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xuICB9XG5cbiAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuICAgIGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIG1pZ3JhdGVTZXR0aW5ncygpIHtcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgdGhpcy5sb2FkRGF0YSgpO1xuICAgIGlmIChkYXRhPy5yZWFkTW9kZUZpbGVzICYmICFkYXRhPy5ydWxlcykge1xuICAgICAgLy8gTWlncmF0ZSBmcm9tIG9sZCBmb3JtYXRcbiAgICAgIHRoaXMuc2V0dGluZ3MgPSB7XG4gICAgICAgIHJ1bGVzOiBkYXRhLnJlYWRNb2RlRmlsZXMubWFwKChwYXRoOiBzdHJpbmcpID0+ICh7XG4gICAgICAgICAgcGF0aCxcbiAgICAgICAgICB0eXBlOiBcImZpbGVcIiBhcyBjb25zdCxcbiAgICAgICAgfSkpLFxuICAgICAgfTtcbiAgICAgIGF3YWl0IHRoaXMuc2F2ZVNldHRpbmdzKCk7XG4gICAgfVxuICB9XG59XG4iLCAiaW1wb3J0IHtcbiAgQXBwLFxuICBQbHVnaW5TZXR0aW5nVGFiLFxuICBTZXR0aW5nLFxuICBURmlsZSxcbiAgVEZvbGRlcixcbiAgVEFic3RyYWN0RmlsZSxcbiAgbm9ybWFsaXplUGF0aCxcbiAgRnV6enlTdWdnZXN0TW9kYWwsXG59IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IFNlbGVjdGl2ZVJlYWRNb2RlUGx1Z2luIGZyb20gXCIuL21haW5cIjtcblxuZXhwb3J0IGludGVyZmFjZSBSZWFkTW9kZVJ1bGUge1xuICBwYXRoOiBzdHJpbmc7XG4gIHR5cGU6IFwiZmlsZVwiIHwgXCJmb2xkZXJcIjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZWxlY3RpdmVSZWFkTW9kZVNldHRpbmdzIHtcbiAgcnVsZXM6IFJlYWRNb2RlUnVsZVtdO1xufVxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9TRVRUSU5HUzogU2VsZWN0aXZlUmVhZE1vZGVTZXR0aW5ncyA9IHtcbiAgcnVsZXM6IFtdLFxufTtcblxuY2xhc3MgRmlsZUZvbGRlclN1Z2dlc3RNb2RhbCBleHRlbmRzIEZ1enp5U3VnZ2VzdE1vZGFsPFRBYnN0cmFjdEZpbGU+IHtcbiAgY29uc3RydWN0b3IoXG4gICAgYXBwOiBBcHAsXG4gICAgcHJpdmF0ZSBvbkNob29zZTogKGl0ZW06IFRBYnN0cmFjdEZpbGUpID0+IHZvaWQsXG4gICAgcHJpdmF0ZSBzaG93Rm9sZGVyczogYm9vbGVhbiA9IHRydWUsXG4gICkge1xuICAgIHN1cGVyKGFwcCk7XG4gIH1cblxuICBnZXRJdGVtcygpOiBUQWJzdHJhY3RGaWxlW10ge1xuICAgIGNvbnN0IGl0ZW1zOiBUQWJzdHJhY3RGaWxlW10gPSBbXTtcblxuICAgIGNvbnN0IGFkZEl0ZW1zID0gKGZvbGRlcjogVEZvbGRlcikgPT4ge1xuICAgICAgaWYgKHRoaXMuc2hvd0ZvbGRlcnMgJiYgZm9sZGVyLnBhdGgpIHtcbiAgICAgICAgaXRlbXMucHVzaChmb2xkZXIpO1xuICAgICAgfVxuXG4gICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIGZvbGRlci5jaGlsZHJlbikge1xuICAgICAgICBpZiAoY2hpbGQgaW5zdGFuY2VvZiBURmlsZSAmJiBjaGlsZC5leHRlbnNpb24gPT09IFwibWRcIikge1xuICAgICAgICAgIGl0ZW1zLnB1c2goY2hpbGQpO1xuICAgICAgICB9IGVsc2UgaWYgKGNoaWxkIGluc3RhbmNlb2YgVEZvbGRlcikge1xuICAgICAgICAgIGFkZEl0ZW1zKGNoaWxkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG5cbiAgICBhZGRJdGVtcyh0aGlzLmFwcC52YXVsdC5nZXRSb290KCkpO1xuICAgIHJldHVybiBpdGVtcztcbiAgfVxuXG4gIGdldEl0ZW1UZXh0KGl0ZW06IFRBYnN0cmFjdEZpbGUpOiBzdHJpbmcge1xuICAgIHJldHVybiBpdGVtLnBhdGggfHwgXCIvXCI7XG4gIH1cblxuICBvbkNob29zZUl0ZW0oaXRlbTogVEFic3RyYWN0RmlsZSk6IHZvaWQge1xuICAgIHRoaXMub25DaG9vc2UoaXRlbSk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFNlbGVjdGl2ZVJlYWRNb2RlU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xuICBwbHVnaW46IFNlbGVjdGl2ZVJlYWRNb2RlUGx1Z2luO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IFNlbGVjdGl2ZVJlYWRNb2RlUGx1Z2luKSB7XG4gICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luO1xuICB9XG5cbiAgZGlzcGxheSgpOiB2b2lkIHtcbiAgICBjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xuXG4gICAgY29udGFpbmVyRWwuZW1wdHkoKTtcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbChcImgyXCIsIHsgdGV4dDogXCJTZWxlY3RpdmUgUmVhZCBNb2RlIFNldHRpbmdzXCIgfSk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiUmVhZCBNb2RlIFJ1bGVzXCIpXG4gICAgICAuc2V0RGVzYyhcIkNvbmZpZ3VyZSB3aGljaCBmaWxlcyBvciBmb2xkZXJzIHNob3VsZCBvcGVuIGluIHJlYWQgbW9kZVwiKVxuICAgICAgLmFkZEJ1dHRvbigoYnV0dG9uKSA9PiB7XG4gICAgICAgIGJ1dHRvblxuICAgICAgICAgIC5zZXRCdXR0b25UZXh0KFwiQWRkIFJ1bGVcIilcbiAgICAgICAgICAuc2V0Q3RhKClcbiAgICAgICAgICAub25DbGljaygoKSA9PiB7XG4gICAgICAgICAgICBuZXcgRmlsZUZvbGRlclN1Z2dlc3RNb2RhbCh0aGlzLmFwcCwgKGl0ZW0pID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgcnVsZTogUmVhZE1vZGVSdWxlID0ge1xuICAgICAgICAgICAgICAgIHBhdGg6IGl0ZW0ucGF0aCxcbiAgICAgICAgICAgICAgICB0eXBlOiBpdGVtIGluc3RhbmNlb2YgVEZvbGRlciA/IFwiZm9sZGVyXCIgOiBcImZpbGVcIixcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucnVsZXMucHVzaChydWxlKTtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgICAgICAgfSkub3BlbigpO1xuICAgICAgICAgIH0pO1xuICAgICAgfSk7XG5cbiAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5ydWxlcy5mb3JFYWNoKChydWxlLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3Qgc2V0dGluZyA9IG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAuc2V0TmFtZShydWxlLnBhdGggfHwgXCIvXCIpXG4gICAgICAgIC5zZXREZXNjKGBUeXBlOiAke3J1bGUudHlwZX1gKVxuICAgICAgICAuYWRkRHJvcGRvd24oKGRyb3Bkb3duKSA9PiB7XG4gICAgICAgICAgZHJvcGRvd25cbiAgICAgICAgICAgIC5hZGRPcHRpb24oXCJmaWxlXCIsIFwiRmlsZVwiKVxuICAgICAgICAgICAgLmFkZE9wdGlvbihcImZvbGRlclwiLCBcIkZvbGRlclwiKVxuICAgICAgICAgICAgLnNldFZhbHVlKHJ1bGUudHlwZSlcbiAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWU6IFwiZmlsZVwiIHwgXCJmb2xkZXJcIikgPT4ge1xuICAgICAgICAgICAgICBydWxlLnR5cGUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pXG4gICAgICAgIC5hZGRFeHRyYUJ1dHRvbigoYnV0dG9uKSA9PiB7XG4gICAgICAgICAgYnV0dG9uXG4gICAgICAgICAgICAuc2V0SWNvbihcInBlbmNpbFwiKVxuICAgICAgICAgICAgLnNldFRvb2x0aXAoXCJDaGFuZ2UgcGF0aFwiKVxuICAgICAgICAgICAgLm9uQ2xpY2soKCkgPT4ge1xuICAgICAgICAgICAgICBuZXcgRmlsZUZvbGRlclN1Z2dlc3RNb2RhbChcbiAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICAoaXRlbSkgPT4ge1xuICAgICAgICAgICAgICAgICAgcnVsZS5wYXRoID0gaXRlbS5wYXRoO1xuICAgICAgICAgICAgICAgICAgcnVsZS50eXBlID0gaXRlbSBpbnN0YW5jZW9mIFRGb2xkZXIgPyBcImZvbGRlclwiIDogXCJmaWxlXCI7XG4gICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcnVsZS50eXBlID09PSBcImZvbGRlclwiLFxuICAgICAgICAgICAgICApLm9wZW4oKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KVxuICAgICAgICAuYWRkRXh0cmFCdXR0b24oKGJ1dHRvbikgPT4ge1xuICAgICAgICAgIGJ1dHRvblxuICAgICAgICAgICAgLnNldEljb24oXCJ0cmFzaFwiKVxuICAgICAgICAgICAgLnNldFRvb2x0aXAoXCJSZW1vdmVcIilcbiAgICAgICAgICAgIC5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucnVsZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAvLyBBZGQgaWNvbiBiYXNlZCBvbiB0eXBlXG4gICAgICBzZXR0aW5nLm5hbWVFbC5wcmVwZW5kKFxuICAgICAgICBjcmVhdGVTcGFuKHtcbiAgICAgICAgICB0ZXh0OiBydWxlLnR5cGUgPT09IFwiZm9sZGVyXCIgPyBcIlx1RDgzRFx1RENDMSBcIiA6IFwiXHVEODNEXHVEQ0M0IFwiLFxuICAgICAgICAgIGNsczogXCJyZWFkLW1vZGUtaWNvblwiLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICAvLyBRdWljayBhY3Rpb25zXG4gICAgY29udGFpbmVyRWwuY3JlYXRlRWwoXCJoM1wiLCB7IHRleHQ6IFwiUXVpY2sgQWN0aW9uc1wiIH0pO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkFkZCBjdXJyZW50IGxvY2F0aW9uXCIpXG4gICAgICAuc2V0RGVzYyhcIkFkZCB0aGUgY3VycmVudCBmaWxlIG9yIGl0cyBwYXJlbnQgZm9sZGVyXCIpXG4gICAgICAuYWRkQnV0dG9uKChidXR0b24pID0+IHtcbiAgICAgICAgYnV0dG9uLnNldEJ1dHRvblRleHQoXCJBZGQgQ3VycmVudCBGaWxlXCIpLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlRmlsZSgpO1xuICAgICAgICAgIGlmIChmaWxlKSB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5ydWxlcy5wdXNoKHtcbiAgICAgICAgICAgICAgcGF0aDogZmlsZS5wYXRoLFxuICAgICAgICAgICAgICB0eXBlOiBcImZpbGVcIixcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICAgIC5hZGRCdXR0b24oKGJ1dHRvbikgPT4ge1xuICAgICAgICBidXR0b24uc2V0QnV0dG9uVGV4dChcIkFkZCBDdXJyZW50IEZvbGRlclwiKS5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAud29ya3NwYWNlLmdldEFjdGl2ZUZpbGUoKTtcbiAgICAgICAgICBpZiAoZmlsZSkge1xuICAgICAgICAgICAgY29uc3QgZm9sZGVyID0gZmlsZS5wYXJlbnQ7XG4gICAgICAgICAgICBpZiAoZm9sZGVyKSB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnJ1bGVzLnB1c2goe1xuICAgICAgICAgICAgICAgIHBhdGg6IGZvbGRlci5wYXRoLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwiZm9sZGVyXCIsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICB9XG59XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsSUFBQUEsbUJBQTJEOzs7QUNBM0Qsc0JBU087QUFZQSxJQUFNLG1CQUE4QztBQUFBLEVBQ3pELE9BQU8sQ0FBQztBQUNWO0FBRUEsSUFBTSx5QkFBTixjQUFxQyxrQ0FBaUM7QUFBQSxFQUNwRSxZQUNFLEtBQ1EsVUFDQSxjQUF1QixNQUMvQjtBQUNBLFVBQU0sR0FBRztBQUhEO0FBQ0E7QUFBQSxFQUdWO0FBQUEsRUFFQSxXQUE0QjtBQUMxQixVQUFNLFFBQXlCLENBQUM7QUFFaEMsVUFBTSxXQUFXLENBQUMsV0FBb0I7QUFDcEMsVUFBSSxLQUFLLGVBQWUsT0FBTyxNQUFNO0FBQ25DLGNBQU0sS0FBSyxNQUFNO0FBQUEsTUFDbkI7QUFFQSxpQkFBVyxTQUFTLE9BQU8sVUFBVTtBQUNuQyxZQUFJLGlCQUFpQix5QkFBUyxNQUFNLGNBQWMsTUFBTTtBQUN0RCxnQkFBTSxLQUFLLEtBQUs7QUFBQSxRQUNsQixXQUFXLGlCQUFpQix5QkFBUztBQUNuQyxtQkFBUyxLQUFLO0FBQUEsUUFDaEI7QUFBQSxNQUNGO0FBQUEsSUFDRjtBQUVBLGFB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
